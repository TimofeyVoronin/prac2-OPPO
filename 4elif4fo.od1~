#include "sea.h"
#include "FileError.h"
#include <iostream>
#include <fstream>
#include <sstream>
#include <filesystem> // Добавьте заголовочный файл
#include "../../pr1-OPPO/SeaTest/pch.h"

using namespace std;

void printSeaInfo(const Sea& sea)
{
    cout << "Sea Name: " << sea.name << endl;
    cout << "Sea Depth: " << sea.depth << endl;
    cout << "Sea Salinity: " << sea.salinity << endl;
}

vector<Sea> createObjectsFromFile(const string& filename)
{
    // Вектор объектов Sea для хранения данных о морях
    vector<Sea> seas;

    // Получим абсолютный путь к файлу
    string absolutePath = std::filesystem::absolute(filename).string(); // Обратите внимание на std::

    // Открытие файла
    ifstream file(absolutePath);

    // Проверка успешности открытия файла
    if (!file.is_open())
    {
        cerr << "Ошибка открытия файла: " << absolutePath << endl;
        throw FileError("Ошибка открытия файла: " + absolutePath);
    }
    else
    {
        cout << "Файл успешно открыт: " << absolutePath << endl;
    }

    // Строка для считывания данных из файла
    string line;

    // Считывание данных из файла и создание объектов Sea
    while (getline(file, line))
    {
        // Использование stringstream для извлечения данных из строки
        istringstream iss(line);
        string name;
        double depth, salinity;

        // Извлечение данных из строки и создание объекта Sea
        if (!(iss >> name >> depth >> salinity))
        {
            throw FileError("Ошибка чтения данных из файла: " + absolutePath);
        }
        seas.push_back({ name, depth, salinity });
    }

    // Закрытие файла после чтения
    file.close();

    // Возвращение вектора объектов Sea
    return seas;
}